<!DOCTYPE html><html lang="uz">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta charset="UTF-8">
<title>Reels Smooth Scroll + AdsGram</title>
<style>
  body {
    margin: 0;
    background: #000;
    height: 100vh;
    overflow-y: scroll;
    scroll-snap-type: y mandatory;
    scroll-behavior: smooth;
    font-family: Arial, sans-serif;
  }
  .post {
    height: 100vh;
    scroll-snap-align: start;
    position: relative;
  }
  video {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  .title {
    position: absolute;
    bottom: 60px;
    left: 20px;
    color: #fff;
    font-size: 20px;
    text-shadow: 0 0 10px #000;
  }
  .download-btn {
    position: absolute;
    bottom: 20px;
    left: 20px;
    background: rgba(255,255,255,0.8);
    color: #000;
    padding: 10px 15px;
    border-radius: 8px;
    text-decoration: none;
    font-weight: bold;
  }
  .download-btn:hover {
    background: rgba(255,255,255,1);
  }
</style>
</head>
<body>
<div id="feed"></div>
<script src="https://sad.adsgram.ai/js/sad.min.js"></script>
<script>
// -----------------------------
// Videolar ro'yxati
// -----------------------------
let videos = [
  "https://pages111.github.io/video/VID_20251128_120459_430.mp4",
  "https://pages111.github.io/video/VID_20251128_121221_180.mp4",
  "https://pages111.github.io/video/VID_20251128_122137_351.mp4",
  "https://pages111.github.io/video/VID_20251128_122455_934.mp4"
];
videos.sort(() => Math.random() - 0.5);const feed = document.getElementById("feed");

// -----------------------------
// HTMLga joylash
// -----------------------------
videos.forEach((v, i) => {
const div = document.createElement('div');
div.classList.add('post');
div.innerHTML = "<video src="${v}" playsinline muted></video> <div class="title">Reel ${i+1}</div> <a class="download-btn" href="${v}" target="_blank">⬇️ Yuklab olish</a>";
feed.appendChild(div);
});

const allVideos = document.querySelectorAll(".post video");
const downloadButtons = document.querySelectorAll(".download-btn");

// -----------------------------
// Smooth auto-play
// -----------------------------
const observer = new IntersectionObserver(entries => {
entries.forEach(entry => {
if(entry.isIntersecting){
allVideos.forEach(v => v.pause());
entry.target.play().catch(()=>{});
}
});
},{ threshold: 0.7 });
allVideos.forEach(v => observer.observe(v));

// -----------------------------
// Birinchi video auto-play (muted)
window.addEventListener("load", () => {
if(allVideos.length>0) allVideos[0].play().catch(()=>{});
});

// -----------------------------
// Foydalanuvchi birinchi marta tegsa, ovoz yoqish
document.body.addEventListener("click", ()=> {
allVideos.forEach(v => v.muted=false);
},{once:true});

// -----------------------------
// AdsGram
const blockId = "int-18350";
const adCooldown = 150000;
let lastAdTime = 0;
let watchedVideos = 0;

function showAd(){
const now = Date.now();
if(now-lastAdTime<adCooldown) return;
lastAdTime = now;
window.Adsgram.init({blockId}).show().then(r => console.log("Ad watched:", r)).catch(r => console.log("Ad error:", r));
}

// -----------------------------
// Download tugmasi ishlaydi (reklamasiz)
downloadButtons.forEach(btn => {
btn.addEventListener("click", e=>{
e.preventDefault();
const url = btn.getAttribute('href');
fetch(url)
.then(resp=>resp.blob())
.then(blob=>{
const link = document.createElement('a');
link.href = URL.createObjectURL(blob);
link.download = url.split('/').pop();
link.click();
});
});
});

// -----------------------------
// Auto-reklama: 2 sekunddan keyin
setTimeout(showAd,2000);

// -----------------------------
// Auto-reklama: 20 video ko‘rilganda
allVideos.forEach(video=>{
video.addEventListener("play", ()=>{
watchedVideos++;
if(watchedVideos%20===0) showAd();
});
});

// -----------------------------
// Ortga tugma Mini App-da sahifada qolishi uchun
if(window.Telegram && window.Telegram.WebApp){
window.Telegram.WebApp.onEvent('backButtonClicked', ()=>{
window.scrollTo({top:0,behavior:'smooth'});
});
}
</script>

</body>
</html>
